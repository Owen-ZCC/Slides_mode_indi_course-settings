# 互动课件编辑器 - 交互逻辑文档

<document-overview>
  <name>Interactive Courseware Editor</name>
  <description>互动课件编辑器的侧边栏 Tag 点击交互逻辑和工作区域工作流程</description>
  <version>1.0</version>
</document-overview>

---

## 整体布局结构

<layout>
  <component name="top-bar" position="顶部">
    <description>顶部工具栏，包含返回、标题、保存状态、预览、保存、发布按钮</description>
    <sub-component name="top-bar-left">返回按钮 + 课程标题 + 保存状态</sub-component>
    <sub-component name="top-bar-right">预览、保存、发布按钮</sub-component>
  </component>

  <component name="left-container" position="左侧">
    <sub-component name="primary-menu">一级菜单（侧边栏 Tag）</sub-component>
    <sub-component name="secondary-panel">二级面板（浮窗/抽屉）</sub-component>
  </component>

  <component name="center-area" position="中央">
    <sub-component name="element-toolbar">元素工具栏</sub-component>
    <sub-component name="slides-area">幻灯片编辑区域</sub-component>
    <sub-component name="bottom-outline">底部页面大纲</sub-component>
  </component>

  <component name="right-panel" position="右侧">
    <description>右侧大纲面板（可折叠）</description>
  </component>
</layout>

---

## 侧边栏 Tag 交互逻辑

<sidebar-tags>
  <tag id="ai" name="Coco AI" panel-id="aiPanel">
    <icon>层叠图标</icon>
    <description>AI 对话面板，用于通过自然语言生成课件</description>
  </tag>

  <tag id="pages" name="页面" panel-id="pagesPanel">
    <icon>文档图标</icon>
    <description>页面模板选择面板</description>
  </tag>

  <tag id="tools" name="互动工具" panel-id="toolsPanel">
    <icon>齿轮图标</icon>
    <description>互动工具选择面板（选择题、问答、投票等）</description>
  </tag>

  <tag id="apps" name="AI应用" panel-id="appsPanel">
    <icon>四宫格图标</icon>
    <description>AI 应用添加面板</description>
  </tag>

  <tag id="web" name="交互网页" panel-id="webPanel">
    <icon>地球图标</icon>
    <description>交互网页添加面板</description>
  </tag>

  <tag id="resources" name="资源" panel-id="resourcesPanel">
    <icon>文件夹图标</icon>
    <description>资源管理面板（视频、音频、文档、素材）</description>
  </tag>
</sidebar-tags>

---

## 侧边栏点击交互流程

<interaction-flow name="sidebar-click">

  <step number="1" name="点击侧边栏 Tag">
    <trigger>用户点击 .menu-item 元素</trigger>
    <action>
      <code>
document.querySelectorAll('.primary-menu .menu-item').forEach(item => {
    item.addEventListener('click', function() {
        // 1. 移除所有 Tag 的 active 状态
        document.querySelectorAll('.primary-menu .menu-item').forEach(i => i.classList.remove('active'));

        // 2. 为当前点击的 Tag 添加 active 状态
        this.classList.add('active');

        // 3. 获取 panel 类型
        const panelType = this.getAttribute('data-panel');

        // 4. 切换到对应面板
        switchToPanel(panelType);
    });
});
      </code>
    </action>
  </step>

  <step number="2" name="切换面板">
    <function>switchToPanel(panelType)</function>
    <logic>
      <action>移除所有面板的 collapsed 和 hidden 类</action>
      <action>根据 panelType 隐藏其他面板（添加 hidden 类）</action>
      <action>显示目标面板</action>
      <action>调用 restoreNormalView() 恢复正常视图</action>
    </logic>
    <panel-mapping>
      <map type="ai" panel="aiPanel" />
      <map type="pages" panel="pagesPanel" />
      <map type="tools" panel="toolsPanel" />
      <map type="apps" panel="appsPanel" />
      <map type="web" panel="webPanel" />
      <map type="resources" panel="resourcesPanel" />
    </panel-mapping>
  </step>

  <step number="3" name="面板展开/折叠">
    <function>toggleSecondaryPanel()</function>
    <logic>
      <action>查找当前激活的面板（非 hidden 状态）</action>
      <action>切换 collapsed 类</action>
      <action>更新折叠按钮图标方向</action>
    </logic>
    <states>
      <state name="expanded">面板宽度 420px，箭头指向左</state>
      <state name="collapsed">面板宽度 0，箭头指向右</state>
    </states>
  </step>

</interaction-flow>

---

## 二级面板详细交互

### 1. Coco AI 面板

<panel id="aiPanel" name="Coco AI">
  <structure>
    <header>标题 + 折叠按钮</header>
    <input-container>
      <textarea>输入框（可自动调整高度）</textarea>
      <upload-btn>上传参考资料按钮</upload-btn>
      <status-text>生成状态提示</status-text>
      <send-btn>发送按钮</send-btn>
    </input-container>
    <chat-messages>对话消息区域</chat-messages>
  </structure>

  <interaction name="send-message">
    <trigger>点击发送按钮或按 Enter</trigger>
    <flow>
      <step>添加用户消息到聊天区域</step>
      <step>清空输入框</step>
      <step>输入框移动到底部（添加 .bottom 类）</step>
      <step>显示生成状态</step>
      <step>禁用输入和按钮</step>
      <step>模拟 AI 回复（800ms 后）</step>
      <step>生成完成后切换到编辑模式</step>
      <step>恢复输入状态</step>
    </flow>
  </interaction>
</panel>

### 2. 页面模板面板

<panel id="pagesPanel" name="页面">
  <structure>
    <header>标题 + 折叠按钮</header>
    <template-grid>
      <template-card type="title">标题页</template-card>
      <template-card type="image">图片页</template-card>
      <template-card type="content">内容页</template-card>
      <template-card type="text-image">文图页</template-card>
      <template-card type="image-text">图文页</template-card>
      <template-card type="upload-ppt">上传PPT</template-card>
    </template-grid>
  </structure>

  <interaction name="add-page">
    <trigger>点击模板卡片</trigger>
    <function>addPageFromTemplate(templateType)</function>
    <flow>
      <step>如果未进入编辑模式，先切换到编辑模式</step>
      <step>在底部大纲添加新页面缩略图</step>
      <step>如果是图片类模板，自动插入图片元素</step>
      <step>同步右侧大纲</step>
    </flow>
  </interaction>
</panel>

### 3. 互动工具面板

<panel id="toolsPanel" name="互动工具">
  <structure>
    <header>标题 + 折叠按钮</header>
    <view name="tools-list-view">
      <intro>插画式说明</intro>
      <tools-grid>
        <tool-card type="choice">选择</tool-card>
        <tool-card type="qa">问答</tool-card>
        <tool-card type="vote">投票</tool-card>
        <tool-card type="photo">拍照</tool-card>
        <tool-card type="fillblank">填空</tool-card>
        <tool-card type="sort">排序</tool-card>
        <tool-card type="whiteboard">白板</tool-card>
        <tool-card type="flashcard">抽认卡</tool-card>
        <tool-card type="cocopi">CocoPi</tool-card>
        <tool-card type="workspace">创作空间</tool-card>
      </tools-grid>
    </view>
    <view name="tools-config-view" hidden="true">
      <config-header>返回按钮 + 工具名称</config-header>
      <config-content>动态生成的配置项</config-content>
    </view>
  </structure>

  <interaction name="select-tool">
    <trigger>点击工具卡片</trigger>
    <function>selectTool(toolType)</function>
    <flow>
      <step>设置 currentTool 变量</step>
      <step>调用 switchToToolMode(toolType) 切换到工具模式</step>
      <step>调用 showToolConfig(toolType) 显示配置面板</step>
      <step>调用 showToolEditArea(toolType) 显示工具编辑区域</step>
    </flow>
  </interaction>

  <interaction name="switch-to-tool-mode">
    <function>switchToToolMode(toolType)</function>
    <flow>
      <step>设置 isToolMode = true</step>
      <step>隐藏普通元素工具栏</step>
      <step>显示底部大纲</step>
      <step>隐藏占位符</step>
      <step>如果未进入编辑模式，生成示例页面</step>
    </flow>
  </interaction>

  <interaction name="show-tool-config">
    <function>showToolConfig(toolType)</function>
    <flow>
      <step>隐藏工具列表视图</step>
      <step>显示工具配置视图</step>
      <step>更新配置标题</step>
      <step>根据工具类型动态生成配置项（开关、单选等）</step>
      <step>隐藏面板顶部标题栏</step>
    </flow>
  </interaction>
</panel>

### 4. AI应用面板

<panel id="appsPanel" name="AI应用">
  <structure>
    <header>标题 + 折叠按钮</header>
    <template-grid>
      <template-card action="openAIAppCenter">应用中心</template-card>
      <template-card action="openCreateAppModal">创建应用</template-card>
    </template-grid>
  </structure>

  <interaction name="open-app-center">
    <trigger>点击"应用中心"卡片</trigger>
    <function>openAIAppCenter()</function>
    <flow>
      <step>显示 aiAppCenterModal 浮窗（添加 .active 类）</step>
      <step>调用 renderAppGrid() 渲染应用列表</step>
    </flow>
  </interaction>

  <floating-modal id="aiAppCenterModal">
    <structure>
      <header>标题 + 关闭按钮</header>
      <filters>来源筛选 + 类型筛选 + 模式筛选</filters>
      <app-grid>应用卡片网格（3列）</app-grid>
      <footer>已选数量 + 取消/确定按钮</footer>
    </structure>
    <interaction>
      <action name="select-app">点击卡片切换选中状态</action>
      <action name="filter">下拉筛选过滤应用</action>
      <action name="confirm">确定添加选中的应用到课件</action>
    </interaction>
  </floating-modal>
</panel>

### 5. 交互网页面板

<panel id="webPanel" name="交互网页">
  <structure>
    <view name="webListView">
      <header>标题 + 折叠按钮</header>
      <template-grid>
        <template-card action="openWebCenter">网页中心</template-card>
        <template-card action="uploadWebPage">上传网页</template-card>
        <template-card action="crawlWebPage">爬取网页</template-card>
      </template-grid>
    </view>
    <view name="webConfigView" hidden="true">
      <upload-web-view>上传网页配置表单</upload-web-view>
      <crawl-web-view>爬取网页配置表单</crawl-web-view>
    </view>
  </structure>

  <interaction name="upload-web">
    <trigger>点击"上传网页"</trigger>
    <flow>
      <step>切换到 webConfigView</step>
      <step>显示 uploadWebView 表单</step>
      <step>支持上传文件或粘贴代码两种方式</step>
    </flow>
  </interaction>

  <floating-modal id="webCenterModal">
    <structure>
      <header>标题 + 关闭按钮</header>
      <filters>来源筛选 + 类型筛选</filters>
      <web-grid>网页卡片网格</web-grid>
      <footer>已选数量 + 取消/确定按钮</footer>
    </structure>
  </floating-modal>
</panel>

### 6. 资源面板

<panel id="resourcesPanel" name="资源">
  <structure>
    <header>标题 + 折叠按钮</header>
    <template-grid>
      <template-card action="openVideoSourceModal">视频</template-card>
      <template-card action="openAudioUploadModal">音频</template-card>
      <template-card action="openDocumentUploadModal">文档</template-card>
      <template-card action="openCollectionModal">素材</template-card>
    </template-grid>
  </structure>

  <floating-modals>
    <modal id="videoSourceModal">选择本地视频或B站视频</modal>
    <modal id="audioUploadModal">上传音频文件</modal>
    <modal id="documentUploadModal">上传文档文件</modal>
    <modal id="collectionModal">上传素材文件</modal>
  </floating-modals>
</panel>

---

## 工作区域（中央编辑区）工作流程

<workspace name="center-area">

  <component name="element-toolbar">
    <description>元素工具栏，编辑模式下显示</description>
    <tools>
      <tool action="insertText">文本</tool>
      <tool action="insertImage">图片</tool>
      <tool action="insertTable">表格</tool>
      <tool action="insertShape">形状（下拉菜单）</tool>
      <tool action="deleteElement">删除</tool>
    </tools>
    <visibility>
      <condition>isEditMode === true</condition>
      <class>.visible</class>
    </visibility>
  </component>

  <component name="slides-area">
    <description>幻灯片编辑区域</description>
    <states>
      <state name="placeholder">
        <condition>未进入编辑模式</condition>
        <display>显示占位符提示</display>
      </state>
      <state name="slide-canvas">
        <condition>编辑模式</condition>
        <display>显示可编辑的幻灯片画布</display>
      </state>
      <state name="tool-edit">
        <condition>工具模式</condition>
        <display>显示工具编辑容器</display>
      </state>
    </states>
  </component>

  <component name="bottom-outline">
    <description>底部页面大纲，显示所有页面缩略图</description>
    <visibility>
      <condition>isEditMode === true</condition>
      <class>.visible</class>
    </visibility>
    <features>
      <feature>页面缩略图展示</feature>
      <feature>拖拽排序</feature>
      <feature>页面操作菜单（复制、新增、删除）</feature>
      <feature>页面间添加按钮</feature>
    </features>
  </component>

</workspace>

---

## 工作区域状态切换流程

<workflow name="workspace-state-transitions">

  <transition name="initial-to-edit">
    <from>初始状态（占位符）</from>
    <to>编辑模式</to>
    <triggers>
      <trigger>AI 生成课件完成</trigger>
      <trigger>点击页面模板添加页面</trigger>
      <trigger>选择互动工具</trigger>
    </triggers>
    <function>switchToEditMode()</function>
    <actions>
      <action>设置 isEditMode = true</action>
      <action>隐藏占位符</action>
      <action>显示元素工具栏</action>
      <action>显示底部大纲</action>
      <action>生成示例页面</action>
    </actions>
  </transition>

  <transition name="edit-to-tool">
    <from>编辑模式</from>
    <to>工具模式</to>
    <trigger>选择互动工具</trigger>
    <function>switchToToolMode(toolType)</function>
    <actions>
      <action>设置 isToolMode = true</action>
      <action>隐藏元素工具栏</action>
      <action>隐藏 slide-canvas</action>
      <action>显示 tool-edit-container</action>
    </actions>
  </transition>

  <transition name="tool-to-edit">
    <from>工具模式</from>
    <to>编辑模式</to>
    <trigger>点击返回按钮或切换到其他面板</trigger>
    <function>restoreNormalView()</function>
    <actions>
      <action>设置 isToolMode = false</action>
      <action>显示 slide-canvas</action>
      <action>隐藏 tool-edit-container</action>
      <action>显示元素工具栏</action>
    </actions>
  </transition>

</workflow>

---

## 页面操作流程

<page-operations>

  <operation name="select-page">
    <function>selectPage(pageNum, evt)</function>
    <flow>
      <step>移除所有页面的 active 状态</step>
      <step>为当前页面添加 active 状态</step>
      <step>更新中央编辑区显示对应页面内容</step>
    </flow>
  </operation>

  <operation name="add-page">
    <function>addPageFromTemplate(templateType)</function>
    <flow>
      <step>检查是否已进入编辑模式</step>
      <step>创建页面缩略图元素</step>
      <step>添加到底部大纲</step>
      <step>同步右侧大纲</step>
    </flow>
  </operation>

  <operation name="copy-page">
    <function>copyPage(pageIndex)</function>
    <description>复制指定页面</description>
  </operation>

  <operation name="delete-page">
    <function>deletePage(pageIndex)</function>
    <description>删除指定页面</description>
  </operation>

  <operation name="add-page-between">
    <function>addPageBetween(pageIndex)</function>
    <description>在两个页面之间插入新页面</description>
  </operation>

</page-operations>

---

## 浮窗交互模式

<floating-modal-pattern>

  <open-modal>
    <method>添加 .active 类到 .floating-modal 元素</method>
    <effect>
      <css>display: flex; opacity: 1;</css>
      <animation>背景淡入 + 内容缩放动画</animation>
    </effect>
  </open-modal>

  <close-modal>
    <triggers>
      <trigger>点击关闭按钮</trigger>
      <trigger>点击遮罩层</trigger>
      <trigger>点击取消按钮</trigger>
    </triggers>
    <method>移除 .active 类</method>
  </close-modal>

  <modal-structure>
    <background>半透明黑色遮罩 + 模糊效果</background>
    <content>白色圆角容器</content>
    <header>标题 + 关闭按钮</header>
    <body>主要内容区域</body>
    <footer>操作按钮</footer>
  </modal-structure>

</floating-modal-pattern>

---

## 关键状态变量

<state-variables>
  <variable name="isEditMode" type="boolean">
    <description>是否进入编辑模式</description>
    <default>false</default>
  </variable>

  <variable name="isToolMode" type="boolean">
    <description>是否处于工具编辑模式</description>
    <default>false</default>
  </variable>

  <variable name="currentTool" type="string">
    <description>当前选中的工具类型</description>
    <values>choice, qa, vote, photo, fillblank, sort, whiteboard, flashcard, cocopi, workspace</values>
  </variable>

  <variable name="selectedApps" type="array">
    <description>AI应用中心已选中的应用列表</description>
  </variable>

  <variable name="selectedWebs" type="array">
    <description>网页中心已选中的网页列表</description>
  </variable>

  <variable name="outlineData" type="object">
    <description>右侧大纲数据（分组 + 未分组）</description>
    <structure>{ groups: [], ungrouped: [] }</structure>
  </variable>
</state-variables>

---

## CSS 类状态说明

<css-states>
  <state class=".active">
    <usage>激活状态（菜单项、页面、浮窗）</usage>
  </state>

  <state class=".hidden">
    <usage>隐藏元素（display: none）</usage>
  </state>

  <state class=".collapsed">
    <usage>折叠状态（面板宽度为0）</usage>
  </state>

  <state class=".visible">
    <usage>显示元素（工具栏、底部大纲）</usage>
  </state>

  <state class=".selected">
    <usage>选中状态（元素、卡片）</usage>
  </state>

  <state class=".generating">
    <usage>生成中状态（发送按钮）</usage>
  </state>
</css-states>

---

## 顶部工具栏按钮样式

<top-bar-buttons>

  <container class="top-bar-right">
    <css>
      display: flex;
      align-items: center;
      gap: 12px;
    </css>
  </container>

  <button-base class="top-btn">
    <css>
      height: 40px;
      padding: 0 20px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    </css>
  </button-base>

  <button name="预览" class="top-btn btn-secondary">
    <icon>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
        <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
      </svg>
    </icon>
    <css>
      background: white;
      color: #374151;
      border: 1.5px solid #e5e7eb;
    </css>
    <hover>
      background: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    </hover>
  </button>

  <button name="保存" class="top-btn btn-secondary">
    <icon>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
        <polyline points="17 21 17 13 7 13 7 21"/>
        <polyline points="7 3 7 8 15 8"/>
      </svg>
    </icon>
    <css>
      background: white;
      color: #374151;
      border: 1.5px solid #e5e7eb;
    </css>
    <hover>
      background: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    </hover>
  </button>

  <button name="发布" class="top-btn btn-primary" onclick="showPublishModal()">
    <icon>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
    </icon>
    <css>
      background: #ff9500;
      color: white;
      box-shadow: 0 2px 8px rgba(255, 149, 0, 0.2);
    </css>
    <hover>
      background: #e68600;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
    </hover>
  </button>

</top-bar-buttons>

---

## 按钮样式规范

<button-styles>

  <style-variant name="btn-secondary" description="次要按钮（预览、保存）">
    <normal>
      background: white;
      color: #374151;
      border: 1.5px solid #e5e7eb;
    </normal>
    <hover>
      background: #f9fafb;
      border-color: #d1d5db;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    </hover>
  </style-variant>

  <style-variant name="btn-primary" description="主要按钮（发布）">
    <normal>
      background: #ff9500;
      color: white;
      box-shadow: 0 2px 8px rgba(255, 149, 0, 0.2);
    </normal>
    <hover>
      background: #e68600;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
    </hover>
  </style-variant>

  <design-tokens>
    <token name="primary-color">#ff9500</token>
    <token name="primary-hover">#e68600</token>
    <token name="border-color">#e5e7eb</token>
    <token name="border-hover">#d1d5db</token>
    <token name="text-secondary">#374151</token>
    <token name="bg-hover">#f9fafb</token>
    <token name="border-radius">10px</token>
    <token name="button-height">40px</token>
    <token name="button-padding">0 20px</token>
    <token name="icon-size">16px</token>
    <token name="gap">8px</token>
  </design-tokens>

</button-styles>

---

## 完整 HTML 结构

<html-structure name="top-bar-right">
```html
<div class="top-bar-right">
    <button class="top-btn btn-secondary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
        </svg>
        预览
    </button>
    <button class="top-btn btn-secondary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17 21 17 13 7 13 7 21"/>
            <polyline points="7 3 7 8 15 8"/>
        </svg>
        保存
    </button>
    <button class="top-btn btn-primary" onclick="showPublishModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
        </svg>
        发布
    </button>
</div>
```
</html-structure>

---

## 完整 CSS 样式

<css-code name="top-bar-buttons">
```css
.top-bar-right {
    display: flex;
    align-items: center;
    gap: 12px;
}

.top-btn {
    height: 40px;
    padding: 0 20px;
    border-radius: 10px;
    border: none;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-secondary {
    background: white;
    color: #374151;
    border: 1.5px solid #e5e7eb;
}

.btn-secondary:hover {
    background: #f9fafb;
    border-color: #d1d5db;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.btn-primary {
    background: #ff9500;
    color: white;
    box-shadow: 0 2px 8px rgba(255, 149, 0, 0.2);
}

.btn-primary:hover {
    background: #e68600;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
}
```
</css-code>
